<div class="standings">
  <div class="standings-header">
    <h1>{{ 'standings.title' | translate }}</h1>
    @if (!loading() && !error() && standingsWithPosition().length > 0) {
      <div class="mobile-segmented" role="group" [attr.aria-label]="'standings.mobileView.label' | translate">
        <button
          type="button"
          class="segment-btn"
          [class.active]="mobileView() === 'short'"
          (click)="setMobileView('short')">
          {{ 'standings.mobileView.short' | translate }}
        </button>
        <button
          type="button"
          class="segment-btn"
          [class.active]="mobileView() === 'full'"
          (click)="setMobileView('full')">
          {{ 'standings.mobileView.full' | translate }}
        </button>
      </div>
    }
  </div>

  @if (loading()) {
    <div class="loading">{{ 'standings.loading' | translate }}</div>
  }

  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!loading() && !error() && standingsWithPosition().length > 0) {
    <div class="legend" aria-label="Form legend">
      <span class="legend-item">
        <span class="legend-dot win" aria-hidden="true"></span>
        {{ 'standings.legend.win' | translate }}
      </span>
      <span class="legend-item">
        <span class="legend-dot draw" aria-hidden="true"></span>
        {{ 'standings.legend.draw' | translate }}
      </span>
      <span class="legend-item">
        <span class="legend-dot loss" aria-hidden="true"></span>
        {{ 'standings.legend.loss' | translate }}
      </span>
      <span class="legend-item">
        <span class="legend-dot none" aria-hidden="true"></span>
        {{ 'standings.legend.noMatch' | translate }}
      </span>
    </div>

    <table
      class="standings-table"
      [class.view-short]="mobileView() === 'short'"
      [class.view-full]="mobileView() === 'full'">
      <thead>
        <tr>
          <th class="col-position">{{ 'standings.position' | translate }}</th>
          <th class="col-change">Δ</th>
          <th class="col-team">{{ 'standings.team' | translate }}</th>
          <th class="col-form">{{ 'standings.form' | translate }}</th>
          <th class="col-played">{{ 'standings.played' | translate }}</th>
          <th class="col-won">{{ 'standings.won' | translate }}</th>
          <th class="col-drawn">{{ 'standings.drawn' | translate }}</th>
          <th class="col-lost">{{ 'standings.lost' | translate }}</th>
          <th class="col-gf">{{ 'standings.goalsFor' | translate }}</th>
          <th class="col-ga">{{ 'standings.goalsAgainst' | translate }}</th>
          <th class="col-gd">{{ 'standings.goalDifference' | translate }}</th>
          <th class="col-points">{{ 'standings.points' | translate }}</th>
        </tr>
      </thead>
      <tbody>
        @for (row of standingsWithPosition(); track row.team.id) {
          <tr>
            <td class="position col-position">{{ row.position }}</td>
            <td class="position-change col-change">
              @if (row.positionChange === null) {
                <span class="change none" aria-label="No previous round">–</span>
              }
              @if (row.positionChange !== null && row.positionChange > 0) {
                <span class="change up" [attr.aria-label]="'Up ' + row.positionChange">
                  ▲ {{ row.positionChange }}
                </span>
              }
              @if (row.positionChange !== null && row.positionChange < 0) {
                <span class="change down" [attr.aria-label]="'Down ' + (row.positionChange * -1)">
                  ▼ {{ row.positionChange * -1 }}
                </span>
              }
              @if (row.positionChange !== null && row.positionChange === 0) {
                <span class="change same" aria-label="No change">–</span>
              }
            </td>
            <td class="team-name col-team">
              <span class="team-link">{{ row.team.name }}</span>
            </td>
            <td class="last-result col-form" aria-label="Last five match results">
              <div class="form-dots" role="group">
                @for (result of row.lastFive; track $index) {
                  <span
                    class="form-dot"
                    [class.win]="result === 'W'"
                    [class.draw]="result === 'D'"
                    [class.loss]="result === 'L'"
                    [class.none]="result === '—'"
                    [attr.aria-label]="result"
                    role="img"
                  ></span>
                }
              </div>
            </td>
            <td class="col-played">{{ row.played }}</td>
            <td class="col-won">{{ row.wins }}</td>
            <td class="col-drawn">{{ row.draws }}</td>
            <td class="col-lost">{{ row.losses }}</td>
            <td class="col-gf">{{ row.goalsFor }}</td>
            <td class="col-ga">{{ row.goalsAgainst }}</td>
            <td class="col-gd" [class.negative]="row.goalDiff < 0" [class.positive]="row.goalDiff > 0">
              {{ row.goalDiff > 0 ? '+' : '' }}{{ row.goalDiff }}
            </td>
            <td class="points col-points">{{ row.points }}</td>
          </tr>
        }
      </tbody>
    </table>
  }

  @if (!loading() && !error() && standingsWithPosition().length === 0) {
    <div class="no-data">No standings data available</div>
  }
</div>
